let page=1,empty_page=!1,block_request=!1,lastScrollTop=0,is_search=!1;function renderClassifieds(e){for(const s of e){let e,t,o=typeof s.thumbnail;e="null"!=o&&"object"!=o&&""!=s.thumbnail?`<img decoding="async" loading="lazy" class="card-img"\n          src="${oss_url}/${s.thumbnail}" width="154px" height="154px">`:`<img decoding="async" loading="lazy"  width='154' height='154'\n         class='card-img' src='${window.location.origin}/static/img/nophoto.jpg'>`,t=0==s.price?"<p class='card-subtitle'> FREE </p>":"object"==typeof s.price?"<p class='card-subtitle'> BID PRICE </p>":`<p class="card-subtitle"> ¬•${s.price} </p>`,template=`\n        <div class="card classified-card">\n          <a href="${window.location.origin}/classifieds/${s.slug}"\n                style="color:black; text-decoration:none; background-color:none">\n\n            <div class="card-img-top img-responsive">\n                ${e}\n            </div>\n\n            <div class="card-body">\n              <h6 class="card-title"> ${s.title} </h6>\n               ${t}\n\n            <span class="card-text small "><small>üìç</small> ${s.city}</span>\n\n            </div>\n          </a>\n        </div>\n            `,document.getElementById("classifieds").insertAdjacentHTML("beforeend",template)}}function searchSubmit(e,s){if(e.preventDefault(),s.value.length>1)try{fetch(search_url+s.value,{credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow"}).then(e=>e.json()).then(e=>{201==e.code?(document.getElementById("not-found").style.display="none",document.getElementById("classifieds").remove(),document.querySelector(".classifieds-list-wrapper").insertAdjacentHTML("afterbegin",'<div id="classifieds" class="small-cards-listing">'),renderClassifieds(e.classifieds),is_search=!0):602==e.code&&(document.getElementById("not-found").style.display="flex")})}catch(e){console.log(e),document.getElementById("not-found").style.display="flex"}}if(!iPhone&&"true"===sessionStorage.restoreScroll){page=parseInt(sessionStorage.page),is_search=JSON.parse(sessionStorage.is_search),document.getElementById("classifieds").remove(),document.querySelector(".classifieds-list-wrapper").innerHTML=JSON.parse(localStorage.getItem("loadedPosts"));const e=document.querySelector(".end-classifieds");null!==e&&e.remove(),document.body.scrollTop=sessionStorage.getItem("scrollPosition"),document.documentElement.scrollTop=sessionStorage.getItem("scrollPosition"),sessionStorage.removeItem("restoreScroll"),sessionStorage.setItem("scrollPosition","0"),sessionStorage.setItem("page","0"),sessionStorage.setItem("page","false")}document.addEventListener("DOMContentLoaded",(function(){document.querySelector(".classifieds-list-wrapper").addEventListener("click",e=>{sessionStorage.setItem("restoreScroll",!0)}),window.addEventListener("scroll",(function(){if(iPhone||"none"!==document.getElementById("navbarBottom").style.display||(document.getElementById("navbarBottom").style.display="block"),""===document.getElementById("search-input").value||!1===is_search){let e=window.pageYOffset||document.documentElement.scrollTop;0==empty_page&&0==block_request&&e>lastScrollTop&&(block_request=!0,page+=1,document.querySelector(".loading").classList.remove("is-hidden"),window.requestAnimationFrame((function(){fetch(`${window.location.href.split("#")[0]}?page=${page}`,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>e.json()).then(e=>{document.querySelector(".loading").classList.add("is-hidden"),block_request=!1,renderClassifieds(e.classifieds),"end"===e.end&&(empty_page=!0,document.querySelector(".loading").classList.add("is-hidden"))}).catch(e=>{console.log(e)})}))),lastScrollTop=e<=0?0:e}}));const e=document.getElementById("search-form"),s=document.getElementById("search-input");window.onbeforeunload=function(e){sessionStorage.setItem("scrollPosition",Math.max(document.body.scrollTop,document.documentElement.scrollTop)),sessionStorage.setItem("page",page),sessionStorage.setItem("is_search",is_search);const s=document.querySelector(".classifieds-list-wrapper").innerHTML;localStorage.setItem("loadedPosts",JSON.stringify(s))},e.addEventListener("submit",(function(e){searchSubmit(e,s)})),wx.ready((function(){try{wx.onMenuShareAppMessage({title:"Obrisk Secondhand Marketplace",desc:"Check out lots of stuff selling right now or post yours",link:location.href,imgUrl:share_img,trigger:function(e){console.log(JSON.stringify(e))},success:function(e){console.log(JSON.stringify(e))},fail:function(e){console.log(JSON.stringify(e))}}),wx.onMenuShareTimeline({title:"Obrisk Secondhand Marketplace",desc:"Check out lots of stuff selling right now or post yours",link:location.href,imgUrl:share_img,trigger:function(e){console.log(JSON.stringify(e))},success:function(e){console.log(JSON.stringify(e))},fail:function(e){console.log(JSON.stringify(e))}})}catch(e){console.log(e)}})),wx.error((function(e){console.log(e)}))}));