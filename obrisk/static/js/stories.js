document.addEventListener("DOMContentLoaded",(function(){document.getElementById("compose-card").classList.contains("is-hidden")&&window.location.href.endsWith("/stories/")&&document.getElementById("compose-card").classList.toggle("is-hidden"),document.getElementById("replyStories").disabled=!0,document.getElementById("replyInput").addEventListener("keyup",(function(){""==this.value?document.getElementById("replyStories").disabled=!0:document.getElementById("replyStories").disabled=!1}));new Waypoint.Infinite({element:document.querySelectorAll(".infinite-container")[0],onBeforePageLoad:function(){document.querySelector(".load").style.cssText+=";display:block !important;"},onAfterPageLoad:function(){document.querySelector(".load").style.display="hidden"}});documentElement.querySelector("input, textarea").value="",document.getElementsByClassName("submit-button")[0].addEventListener("click",(function(e){e.preventDefault(),uploader.fileStats.totalFilesNum>0?document.querySelector("body").dispatchEvent(new CustomEvent("submitClicked",{bubbles:!0})):0!=document.getElementById("publish").value.substring(0,20).length?document.querySelector("body").dispatchEvent(new CustomEvent("uploadComplete",{bubbles:!0})):(error='\n            <div class="alert alert-danger alert-dismissible fade show" role="alert">\n              Please, Upload an image or write something!\n              <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n              </button>\n            </div>',document.getElementsByClassName("compose")[0].insertAdjacentHTML("beforeend",error))})),document.getElementsByClassName("like-wrapper").addEventListener("click",(function(){const e=document.querySelector(this).closest(".card"),t=document.querySelector(e).getAttribute("stories-id");return""!=user?fetch("/stories/like/?stories="+t).then(e=>e.json()).then(t=>{e.querySelectorAll(".like-button").classList.add("is-active"),e.querySelectorAll(".like-button .mdi").classList.toggle("is-active"),e.querySelectorAll(".likes-count .count").textContent(t.likes)}):window.location.href="/auth/login/",!1})),document.getElementsByClassName("close-comments").addEventListener("click",(function(){const e=document.querySelector(this).closest(".card");document.querySelector(e).getAttribute("stories-id");e.querySelectorAll(".post-media").classList.remove("smaller"),e.querySelectorAll(".comments-wrap").classList.toggle("is-hidden")})),$(document.body).on("click",".is-comment",(function(){var e,t,s,o,l=$(this).closest(".card"),n=$(l).attr("stories-id");l.querySelectorAll(".comments-wrap").classList.toggle("is-hidden"),window.scrollTo({top:(e=l[0],t=e.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,{top:t.top+o,left:t.left+s}).top,behavior:"smooth"}),$(".emojionearea-editor").keyup((function(){$(this).closest(".textarea-parent").querySelectorAll(".counter .count").textContent(400-$(this).val().length),$(this).height("auto"),$(this).height($(this).prop("scrollHeight"))})),$("input, textarea").val(""),$(".emojionearea-editor").html(""),$.ajax({url:"/stories/get-thread/",data:{stories:n},type:"GET",cache:!1,success:function(e){e.thread&&""!=e.thread.trim()&&l.querySelectorAll(".comments-body").html(e.thread),l.querySelectorAll("input[name=parent]").val(e.uuid)}}),$(".comment-textarea").classList.add("focused")})),$(document.body).on("click","a#post-comment-button",(function(){post=$(this).closest(".card"),""!=user?$.ajax({url:"/stories/post-comment/",data:post.querySelectorAll(".replyStoriesForm").serialize(),type:"POST",cache:!1,success:function(){post.querySelectorAll(".comment-textarea").val(""),post.querySelectorAll(".comments-count .count").html(parseInt(post.querySelectorAll(".comments-count .count").html(),10)+1);var e=Number(post.querySelectorAll(".comments-heading small").textContent());post.querySelectorAll(".comments-heading small").textContent(e+1);var t=$(post).attr("stories-id");$("input, textarea").val(""),setTimeout((function(){$.ajax({url:"/stories/get-thread/",data:{stories:t},cache:!1,success:function(e){""!=e.thread.trim()&&post.querySelectorAll(".comments-body").html(e.thread),post.querySelectorAll("input[name=parent]").val(e.uuid)}})}),200)},error:function(e){error='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          Sorry we can\'t handle new comments, please try again later.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        ',post.querySelectorAll(".card-footer .media-content").append(error)}}):window.location.href="/auth/login/"})),$("textarea").keyup((function(){$(this).closest(".textarea-parent").querySelectorAll(".counter .count").textContent(400-$(this).val().length),$(this).height("auto"),$(this).height($(this).prop("scrollHeight"))})),$("#publish").on("click",(function(){$(".app-overlay").classList.add("is-active"),$(".close-wrap").classList.remove("is-hidden"),$(".is-new-content").classList.add("is-highlighted"),$(".all-stories ").classList.add("block-scroll")})),$("#publish").on("input",(function(){$(this).val().length>=1||$(".filelist").children().length>0?$("#publish-button").classList.remove("is-disabled"):$("#publish-button").classList.add("is-disabled")})),$(".close-publish").on("click",(function(){$("body").trigger("resetUpload"),$("input, textarea").val(""),$(".app-overlay").classList.remove("is-active"),$(".is-new-content").classList.remove("is-highlighted"),$(".close-wrap").classList.add("is-hidden"),$(".all-stories ").classList.remove("block-scroll"),$("#addVideo").show(),$("#addBtn").show()})),$(document.body).on("click",".is-comment",(function(){var e=$(this).closest(".card"),t=$(e).attr("stories-id");e.querySelectorAll(".post-media").classList.add("smaller"),e.querySelectorAll(".comments-wrap").classList.remove("is-hidden"),e.querySelectorAll("textarea").focus(),$.ajax({url:"/stories/get-thread/",data:{stories:t},cache:!1,success:function(t){""!=t.thread.trim()&&e.querySelectorAll(".comments-body").html(t.thread),e.querySelectorAll("input[name=parent]").val(t.uuid)}})})),$("body").on("uploadComplete",(function(e){$("#id_images").val(images),$("#id_video").val(videos),$("#id_img_error").val(img_error),$.ajax({url:"/stories/post-stories/",data:$("#postStoriesForm").serialize(),type:"POST",cache:!1,success:function(e){$('[name="post"]').val(""),$(".app-overlay").classList.remove("is-active"),$(".is-new-content").classList.remove("is-highlighted"),$(".close-wrap").classList.add("is-hidden"),feather.replace(),$("#postStoriesForm")[0].reset(),$("input, textarea").val(""),$(".stream").prepend(e),lazyload(),$("body").trigger("resetUpload")},error:function(e){error='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          Sorry we can\'t handle new posts, please try again later.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        ',$(".compose").prepend(error)}})})),$(".select-status button").click((function(e){$("#selected-status #viewer-icon").html($(this).querySelectorAll("svg").html()),$("#selected-status span").textContent($(this).querySelectorAll("h3").textContent()),$("#viewers").val($(this).data("status"))})),$(".dropdown-trigger").click((function(e){e.preventDefault(),$(".dropdown-trigger").classList.toggle("is-active")})),$(document.body).on("click",".stry-image",(function(){$.ajax({type:"get",url:"/stories/story-images/?story_id="+$(this).closest("[stories-id]").data("id"),success:function(e){$.fancybox.open(e,{type:"image",loop:!0})}})}))}));var shareMe=function(e,t,s){navigator.share({title:e+" shared a story on Obrisk",text:"Shared: "+t,url:location.origin+"/stories/"+s})};$(document.body).on("click",".delete-story",(function(){location.href=$(this).attr("href")}));