$((function(){new Waypoint.Infinite({element:$(".infinite-container")[0],onBeforePageLoad:function(){$(".load").show()},onAfterPageLoad:function(t){$(".load").hide()}});$("input, textarea").val(""),$(".submit-button").click((function(t){t.preventDefault(),uploader.fileStats.totalFilesNum>0?$("body").trigger("submitClicked"):0!=$("#publish").val().substring(0,20).length?$("body").trigger("uploadComplete"):(error='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          Please, Upload an image or write something!\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        ',$(".compose").prepend(error))})),$(document.body).on("click",".like-wrapper",(function(){var t=$(this).closest(".card"),e=$(t).attr("stories-id");return""!=user?$.ajax({url:"/stories/like/",data:{stories:e},type:"GET",cache:!1,success:function(e){t.find(".like-button").addClass("is-active"),t.find(".like-button .mdi").toggleClass("is-active"),t.find(".likes-count .count").text(e.likes)}}):window.location.href="/auth/login/",!1})),$(document.body).on("click",".close-comments",(function(){var t=$(this).closest(".card");$(t).attr("stories-id");t.find(".post-media").removeClass("smaller"),t.find(".comments-wrap").toggleClass("is-hidden")})),$(document.body).on("click",".is-comment",(function(){var t,e,s,o,a=$(this).closest(".card"),i=$(a).attr("stories-id");a.find(".comments-wrap").toggleClass("is-hidden"),window.scrollTo({top:(t=a[0],e=t.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop,{top:e.top+o,left:e.left+s}).top,behavior:"smooth"}),$(".emojionearea-editor").keyup((function(){$(this).closest(".textarea-parent").find(".counter .count").text(400-$(this).val().length),$(this).height("auto"),$(this).height($(this).prop("scrollHeight"))})),$("input, textarea").val(""),$(".emojionearea-editor").html(""),$.ajax({url:"/stories/get-thread/",data:{stories:i},type:"GET",cache:!1,success:function(t){t.thread&&""!=t.thread.trim()&&a.find(".comments-body").html(t.thread),a.find("input[name=parent]").val(t.uuid)}}),$(".comment-textarea").addClass("focused")})),$(document.body).on("click","a#post-comment-button",(function(){post=$(this).closest(".card"),""!=user?$.ajax({url:"/stories/post-comment/",data:post.find(".replyStoriesForm").serialize(),type:"POST",cache:!1,success:function(){post.find(".comment-textarea").val(""),post.find(".comments-count .count").html(parseInt(post.find(".comments-count .count").html(),10)+1);var t=Number(post.find(".comments-heading small").text());post.find(".comments-heading small").text(t+1);var e=$(post).attr("stories-id");$("input, textarea").val(""),setTimeout((function(){$.ajax({url:"/stories/get-thread/",data:{stories:e},cache:!1,success:function(t){""!=t.thread.trim()&&post.find(".comments-body").html(t.thread),post.find("input[name=parent]").val(t.uuid)}})}),200)},error:function(t){error='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          Sorry we can\'t handle new comments, please try again later.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        ',post.find(".card-footer .media-content").append(error)}}):window.location.href="/auth/login/"})),$("textarea").keyup((function(){$(this).closest(".textarea-parent").find(".counter .count").text(400-$(this).val().length),$(this).height("auto"),$(this).height($(this).prop("scrollHeight"))})),$("#publish").on("click",(function(){$(".app-overlay").addClass("is-active"),$(".close-wrap").removeClass("d-none"),$(".is-new-content").addClass("is-highlighted"),$(".all-stories ").addClass("block-scroll")})),$("#publish").on("input",(function(){$(this).val().length>=1||$(".filelist").children().length>0?$("#publish-button").removeClass("is-disabled"):$("#publish-button").addClass("is-disabled")})),$(".close-publish").on("click",(function(){$("body").trigger("resetUpload"),$("input, textarea").val(""),$(".app-overlay").removeClass("is-active"),$(".is-new-content").removeClass("is-highlighted"),$(".close-wrap").addClass("d-none"),$(".all-stories ").removeClass("block-scroll"),$("#addVideo").show(),$("#addBtn").show()})),$(document.body).on("click",".is-comment",(function(){var t=$(this).closest(".card"),e=$(t).attr("stories-id");t.find(".post-media").addClass("smaller"),t.find(".comments-wrap").removeClass("is-hidden"),t.find("textarea").focus(),$.ajax({url:"/stories/get-thread/",data:{stories:e},cache:!1,success:function(e){""!=e.thread.trim()&&t.find(".comments-body").html(e.thread),t.find("input[name=parent]").val(e.uuid)}})})),$("body").on("uploadComplete",(function(t){$("#id_images").val(images),$("#id_video").val(videos),$("#id_img_error").val(img_error),$.ajax({url:"/stories/post-stories/",data:$("#postStoriesForm").serialize(),type:"POST",cache:!1,success:function(t){$('[name="post"]').val(""),$(".app-overlay").removeClass("is-active"),$(".is-new-content").removeClass("is-highlighted"),$(".close-wrap").addClass("d-none"),feather.replace(),$("#postStoriesForm")[0].reset(),$("input, textarea").val(""),$(".stream").prepend(t),lazyload(),$("body").trigger("resetUpload")},error:function(t){error='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          Sorry we can\'t handle new posts, please try again later.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n        ',$(".compose").prepend(error)}})})),$(".select-status button").click((function(t){$("#selected-status #viewer-icon").html($(this).find("svg").html()),$("#selected-status span").text($(this).find("h3").text()),$("#viewers").val($(this).data("status"))})),$(".dropdown-trigger").click((function(t){t.preventDefault(),$(".dropdown-trigger").toggleClass("is-active")})),$(document.body).on("click",".stry-image",(function(){$.ajax({type:"get",url:"/stories/story-images/?story_id="+$(this).closest("[stories-id]").data("id"),success:function(t){$.fancybox.open(t,{type:"image",loop:!0})}})}))}));var shareMe=function(t,e,s){navigator.share({title:t+" shared a story on Obrisk",text:"Shared: "+e,url:location.origin+"/stories/"+s})};$(document.body).on("click",".delete-story",(function(){location.href=$(this).attr("href")}));