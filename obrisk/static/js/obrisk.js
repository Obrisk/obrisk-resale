/*!
 * Do not edit!. This file is autogenerated by running `npm run browserify`.
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).channels=e()}}((function(){return function e(n,t,o){function i(s,c){if(!t[s]){if(!n[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[s]={exports:{}};n[s][0].call(l.exports,(function(e){var t=n[s][1][e];return i(t||e)}),l,l.exports,e,n,t,o)}return t[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,n,t){"use strict";var o=function(e){return e&&2===e.CLOSING},i=function(e,n,t){Object.defineProperty(n,t,{get:function(){return e[t]},set:function(n){e[t]=n},enumerable:!0,configurable:!0})},r=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},s=["onopen","onclose","onmessage","onerror"],c=function(e,n,t){var a,u,l=this;void 0===t&&(t={});var f=0,d=0,v=!0,p=null,y={};if(!(this instanceof c))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var h={constructor:"undefined"!=typeof WebSocket&&o(WebSocket)?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1};if(Object.keys(h).filter((function(e){return t.hasOwnProperty(e)})).forEach((function(e){return h[e]=t[e]})),!o(h.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var w=h.debug?function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return console.log.apply(console,["RWS:"].concat(e))}:function(){},m=function(e,n){return setTimeout((function(){var t=new Error(n);t.code=e,Array.isArray(y.error)&&y.error.forEach((function(e){return(0,e[0])(t)})),a.onerror&&a.onerror(t)}),0)},b=function(){w("handleClose",{shouldRetry:v}),d++,w("retries count:",d),d>h.maxRetries?m("EHOSTDOWN","Too many failed connection attempts"):(f=f?function(e,n){var t=n*e.reconnectionDelayGrowFactor;return t>e.maxReconnectionDelay?e.maxReconnectionDelay:t}(h,f):r(h),w("handleClose - reconnectDelay:",f),v&&setTimeout(g,f))},g=function(){if(v){w("connect");var t=a,o="function"==typeof e?e():e;if(1===(a=new h.constructor(o,n)).readyState){for(var c in u=setTimeout((function(){w("timeout"),a.close(),m("ETIMEDOUT","Connection timeout")}),h.connectionTimeout),w("bypass properties"),a)["addEventListener","removeEventListener","close","send"].indexOf(c)<0&&i(a,l,c);a.addEventListener("open",(function(){clearTimeout(u),w("open"),f=r(h),w("reconnectDelay:",f),d=0})),a.addEventListener("close",b),function(e,n,t){Object.keys(t).forEach((function(n){t[n].forEach((function(t){var o=t[0],i=t[1];e.addEventListener(n,o,i)}))})),n&&s.forEach((function(t){e[t]=n[t]}))}(a,t,y),a.onclose=a.onclose||p,p=null}}};w("init"),g(),this.close=function(e,n,t){void 0===e&&(e=1e3),void 0===n&&(n="");var o=void 0===t?{}:t,i=o.keepClosed,r=void 0!==i&&i,s=o.fastClose,c=void 0===s||s,u=o.delay,l=void 0===u?0:u;if(w("close - params:",{reason:n,keepClosed:r,fastClose:c,delay:l,retriesCount:d,maxRetries:h.maxRetries}),v=!r&&d<=h.maxRetries,l&&(f=l),a.close(e,n),c){var m={code:e,reason:n,wasClean:!0};b(),a.removeEventListener("close",b),Array.isArray(y.close)&&y.close.forEach((function(e){var n=e[0],t=e[1];n(m),a.removeEventListener("close",n,t)})),a.onclose&&(p=a.onclose,a.onclose(m),a.onclose=null)}},this.send=function(e){a.send(e)},this.addEventListener=function(e,n,t){Array.isArray(y[e])?y[e].some((function(e){return e[0]===n}))||y[e].push([n,t]):y[e]=[[n,t]],a.addEventListener(e,n,t)},this.removeEventListener=function(e,n,t){Array.isArray(y[e])&&(y[e]=y[e].filter((function(e){return e[0]!==n}))),a.removeEventListener(e,n,t)}};n.exports=c},{}],2:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketBridge=void 0;var o,i=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},r=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),s=e("reconnecting-websocket"),c=(o=s)&&o.__esModule?o:{default:o};var a=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=null,this.streams={},this.default_cb=null,this.options=i({},n)}return r(e,[{key:"connect",value:function(e,n,t){var o=void 0,i=("https:"===window.location.protocol?"wss":"ws")+"://"+window.location.host;o=void 0===e?i:"/"==e[0]?""+i+e:e,this.socket=new c.default(o,n,t)}},{key:"listen",value:function(e){var n=this;this.default_cb=e,this.socket.onmessage=function(e){var t=JSON.parse(e.data),o=void 0,i=void 0;if(void 0!==t.stream){o=t.payload,i=t.stream;var r=n.streams[i];r&&r(o,i)}else o=t,i=null,n.default_cb&&n.default_cb(o,i)}}},{key:"demultiplex",value:function(e,n){this.streams[e]=n}},{key:"send",value:function(e){this.socket.send(JSON.stringify(e))}},{key:"stream",value:function(e){var n=this;return{send:function(t){var o={stream:e,payload:t};n.socket.send(JSON.stringify(o))}}}}]),e}();t.WebSocketBridge=a},{"reconnecting-websocket":1}]},{},[2])(2)}));const swSubReg=async()=>{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.register("/serviceworker.js");initialiseState(e)}else showNotAllowed("You can't send push notifications ☹️😢")},initialiseState=e=>{e.showNotification?"denied"!==Notification.permission?!1 in window?showNotAllowed("Push notifications aren't allowed in your browser 🤔"):subscribe(e):showNotAllowed("You prevented us from showing notifications ☹️🤔"):showNotAllowed("Showing notifications isn't supported ☹️😢")},showNotAllowed=e=>{console.log("push notifications show not allowed")};function urlB64ToUint8Array(e){const n=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(n);return new Uint8Array(t.length).map((e,n)=>t.charCodeAt(n))}const subscribe=async e=>{const n=await e.pushManager.getSubscription();if(n)return void sendSubData(n);const t={userVisibleOnly:!0,applicationServerKey:urlB64ToUint8Array(document.querySelector('meta[name="vapid-key"]').content)},o=await e.pushManager.subscribe(t);sendSubData(o)},sendSubData=async e=>{const n=navigator.userAgent.match(/(firefox|msie|chrome|safari|trident)/gi)[0].toLowerCase(),t={status_type:"subscribe",subscription:e.toJSON(),browser:n},o=await fetch("/webpush/save_information",{method:"POST",body:JSON.stringify(t),headers:{"content-type":"application/json"},credentials:"include"});handleResponse(o)},handleResponse=e=>{console.log(e.status)};swSubReg(),document.getElementsByClassName("form-group")[0].classList.remove("row"),document.addEventListener("DOMContentLoaded",(function(){function e(){fetch("/ws/notifications/latest-notifications/").then((function(e){e.text().then((function(e){document.querySelector(".recent-notifications").innerHTML=e}))}))}const n=document.querySelector(".notifications");n.addEventListener("click",(function(t){return n.contains(".recent-notifications #close")?document.querySelector(".recent-notifications").classList.remove("is-active"):(document.querySelector(".recent-notifications").innerHTML="",e()),!1})),e();const t="https:"==window.location.protocol?"wss":"ws",o=new Audio("/static/sound/knock_brush.ogg"),i=t+"://"+window.location.host+"/ws/notifications/",r=new channels.WebSocketBridge;r.connect(i),r.listen((function(e){switch(void 0===e.key&&(e=JSON.parse(e)),e.key){case"new_message":e.recipient==currentUser&&(o.play(),document.querySelector(".msg-notification i").style.display="block !important")}}))}));