{% extends "base.html" %}
{% load static i18n %}
{% load thumbnail %}
{% block title %}{% trans 'Contacts' %}{% endblock %}

{% block head %}
<link href="{% static 'css/messager.css' %}" rel="stylesheet">
<script src="{% static 'js/simulate.js' %}" type="text/javascript"></script>
<script type="text/javascript">
  var activeUser = "{{ active }}";
    //$('a').simulate('click') function() {
     // $('#new-msgs').hide();
    //}

</script>
{% endblock head %}

{% block content %}

<div class="col-md-8 m-auto title">
  <h3>{% trans 'Recent Messages' %}</h3>
</div>
<div class="col-md-8 m-auto list-group users-list">

  {% for user, msg in lists %}
  <a href="{% url 'messager:conversation_detail' user  %}" class="card p-4 mb-3 d-flex flex-row ">
    {% thumbnail user.picture "40x40" crop="center" upscale="true"  as im %}
    <div class="user d-flex">
      <img class="align-self-baseline" src="{{ im.url }}" style="border-radius: 50%;"
        alt="{% trans 'Picture Profile' %}">
      {% empty %}
      <img class="align-self-baseline" src="{% static 'img/user.png' %}" height="40px"
        alt="{% trans 'No Profile Picture' %}" />
      {% endthumbnail %}
      {%  if msg.unread and request.user == msg.recipient %}
      <span class="pull-right -" id="new-msgs" style="margin:0px 10px 0px -10px"> <i class="fa fa-circle"
          aria-hidden="true"></i> </span>
      {% endif %}
      <strong> {{ user.get_profile_name|title }} </strong>
    </div>
    <div class="message-content d-flex ml-2 ml-lg-4 flex-column">
      <span class="last-msg word-break"> {{ msg|truncatechars:50 }} </span>
      <small class="msg-timestamp"> {{ msg.timestamp|date:'N d G:i' }} </small>
    </div>
  </a>
  {% empty %}

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <h4> {% trans "You don't have any contacts in your account." %} </h4>
      </li>
    </ol>
  </nav>

  <p>{% trans "Start a chat from the classifieds details or invite new friends! " %}</p>
  <p>{% trans "If you have questions, then you can chat with the Obrisk team member below... " %}</p>
  <p>{% trans "We will reply you within the shortest time possible." %}</p>

  <a href="{% url 'messager:conversation_detail' super_users.first.username  %}"
    class="list-group-item list-group-item-action ">
    {% thumbnail super_users.first.picture "40x40" crop="center" upscale="true"  as im %}
    <img src="{{ im.url }}" style="border-radius: 50%;" alt="{% trans 'Picture Profile' %}">
    {% empty %}
    <img src="{% static 'img/user.png' %}" height="40px" alt="{% trans 'No Profile Picture' %}" />
    {% endthumbnail %}
    <strong> {{ super_users.first.get_profile_name|title }} </strong> </a>
</div>
{% endfor %}

{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/messager.js' %}" type="text/javascript"></script>
{% endblock extra_js %}