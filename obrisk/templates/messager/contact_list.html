{% extends "base.html" %}
{% load static i18n %}

{% block head %}
<link href="{% static 'css/contact-list.css' %}" rel="stylesheet">
<title>{% trans 'Contacts' %}</title>
{% endblock head %}

{% block content %}
<div class="container mt-5 mb-md-5">

  <div class="row mt-md-5" >

    <div class="col-md-8 m-auto pb-4">
       <h3 style="color: black;"> <strong> {% trans 'Recent Messages' %} </strong></h3>
    </div>

    <div class="col-md-8 col-10 m-auto list-group users-list">
      {% for con in convs %}
          {% if con.first_user.username == request.user.username %}
            <a href="{% url 'messager:conversation_detail' con.second_user.username %}"
              class="card p-4 mb-3 d-flex flex-row ">
              {% if con.second_user.thumbnail %}
              <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{con.second_user.thumbnail}}" alt="Picture Profile"
                style="width:40px;height:40px;border-radius: 50%;"
                class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" id="pic">
              {% else %}
              <img src="{% static 'img/user.png' %}" width="40px" style="width:40px;height:40px;border-radius: 50%;"
                alt="No Profile Picture" class="mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" />
              {% endif %}

              <strong> {{ con.second_user.get_profile_name|title }} </strong>
              
              {% if con.last_msg %}
              <span class="ml-2" id="last-msg"> {{ con.last_msg|truncatechars:50 }} </span>
              {% elif con.img or con.attachment %}
                  <span class="ml-2" id="last-msg"> Attachment </span>
              {% else %}
                  <span class="ml-2" id="last-msg"> New conversation </span>
              {% endif %} 
              <span id="msg-timestamp"> {{ con.time|date:'N d G:i' }} </span>

              {%  if con.unread and request.user.id == con.recipient %}
                 <span class="pull-right ml-2" id="new-msgs"> <i class="fa fa-circle" aria-hidden="true"></i> </span>
              {% endif %}
            </a>

          {% else %}
            <a href="{% url 'messager:conversation_detail' con.first_user.username %}" class="card p-4 mb-3 d-flex flex-row ">
              {% if con.first_user.thumbnail %}
              <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{con.first_user.thumbnail}}" alt="Picture Profile"
                style="width:40px;height:40px;border-radius: 50%;"
                class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" id="pic">
              {% else %}
              <img src="{% static 'img/user.png' %}" height="40px" style="width:40px;height:40px;border-radius: 50%;"
                alt="No Profile Picture" class="mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" />
              {% endif %}

              <strong> {{ con.first_user.get_profile_name|title }} </strong>
              
              {% if con.last_msg %}
              <span class="ml-2" id="last-msg"> {{ con.last_msg|truncatechars:50 }} </span>
              {% elif con.img or con.attachment %}
                  <span class="ml-2" id="last-msg"> Attachment </span>
              {% else %}
                  <span class="ml-2" id="last-msg"> New conversation </span>
              {% endif %}
              <span class="ml-2" id="msg-timestamp"> {{ con.time|date:'N d G:i' }} </span>

              {%  if con.unread and request.user.id == con.recipient %}
              <span class="pull-right ml-2" id="new-msgs"> <i class="fa fa-circle" aria-hidden="true"></i> </span>
              {% endif %}
            </a>
          {% endif %}

      {% empty %}


      <nav aria-label="breadcrumb">
        <ol class="breadcrumb" style="background-color: #3EC4E2;">
          <li class="breadcrumb-item">
            <h4> {% trans "No contacts" %} </h4>
          </li>
        </ol>
      </nav>

      <p>{% trans "Start a chat from the classifieds details or invite friends, Or you can chat with the available Obrisk team member" %}</p>

      <a href="{% url 'messager:conversation_detail' super_users.first.username  %}"
        class="list-group-item list-group-item-action ">
        {% if super_users.first.thumbnail %}
        <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{super_users.first.thumbnail}}" alt="Picture Profile"
          style="width:40px;height:40px;border-radius: 50%;"
          class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" id="pic">
        {% else %}
        <img src="{% static 'img/user.png' %}" width="40px" alt="No Profile Picture"
          class="mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" />
        {% endif %}
        <strong> {{ super_users.first.get_profile_name|title }} </strong> </a>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock content %}



{% block extra_js %}
<script>
  var activeUser = "{{ active }}";
</script>
<script src="{% static 'js/aliyun-oss.min.js' %}?v=3007191" type="text/javascript"></script>
<script src="{% static 'js/messager.js' %}" type="text/javascript"></script>
{% endblock extra_js %}