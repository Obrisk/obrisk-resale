{% extends "base.html" %}
{% load static i18n %}
{% load thumbnail %}
{% block title %}{% trans 'Contacts' %}{% endblock %}

{% block head %}
<link href="{% static 'css/messager.css' %}" rel="stylesheet">
<script src="{% static 'js/simulate.js' %}" type="text/javascript"></script>
<script type="text/javascript">
  var activeUser = "{{ active }}";
    //$('a').simulate('click') function() {
     // $('#new-msgs').hide();
    //}

</script>
{% endblock head %}

{% block content %}

<div class="row" style="margin-top: 1em">
  <div class="col-md-8 title m-auto">
    <h3>Recent Messages</h3>
  </div>
  <div class="col-md-8 list-group users-list m-auto">
    {% for user, msg in lists %}
    <a href="{% url 'messager:conversation_detail' user  %}" class="list-group-item list-group-item-action mb-4">
      {% thumbnail user.picture "40x40" crop="center" upscale="true"  as im %}
      <img src="{{ im.url }}" style="border-radius: 50%;" alt="{% trans 'Picture Profile' %}">
      {% empty %}
      <img src="{% static 'img/user.png' %}" height="40px" alt="{% trans 'No Profile Picture' %}" />
      {% endthumbnail %}
      <strong> {{ user.get_profile_name|title }} </strong>
      <span id="last-msg"> {{ msg|truncatechars:50 }} </span>
      <span id="msg-timestamp"> {{ msg.timestamp|date:'N d G:i' }} </span>
      {%  if msg.unread and request.user == msg.recipient %}
      <span class="pull-right" id="new-msgs"> <i class="fa fa-circle" aria-hidden="true"></i> </span>
      {% endif %}
    </a>
    {% empty %}

    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <h4> {% trans "You don't have any contacts in your account." %} </h4>
        </li>
      </ol>
    </nav>

    <p>{% trans "Start a chat from the classifieds details or invite new friends! " %}</p>
    <p>{% trans "If you have questions, then you can chat with the Obrisk team member below... " %}</p>
    <p>{% trans "We will reply you within the shortest time possible." %}</p>

    <a href="{% url 'messager:conversation_detail' super_users.first.username  %}"
      class="list-group-item list-group-item-action ">
      {% thumbnail super_users.first.picture "40x40" crop="center" upscale="true"  as im %}
      <img src="{{ im.url }}" style="border-radius: 50%;" alt="{% trans 'Picture Profile' %}">
      {% empty %}
      <img src="{% static 'img/user.png' %}" height="40px" alt="{% trans 'No Profile Picture' %}" />
      {% endthumbnail %}
      <strong> {{ super_users.first.get_profile_name|title }} </strong> </a>
  </div>
  {% endfor %}
</div>
{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/messager.js' %}" type="text/javascript"></script>
{% endblock extra_js %}