{% extends "base.html" %}
{% load friendshiptags %}
{% load static i18n %}
{% load thumbnail %}
{% block title %}{% trans 'Contacts' %}{% endblock %}

{% block head %}
<link href="{% static 'css/messager.css' %}" rel="stylesheet">
{% endblock head %}

{% block content %}
<div>
    <a href="{% url 'users:friendship_view_friends' user %}">{% trans 'my friendsü§ù' %}</a>
</div>
<div class="row" style="margin-top: 1em" style="overflow: scroll!important">

  <div class="col-md-8 m-auto title">
    <h4 style="color: black; font-weight: bold;">{% trans 'Recent Messages' %}</h4>
  </div>

  <div class="col-md-8 col-10 m-auto list-group users-list " style="overflow: scroll!important">
    {% for user, msg in zip_list %}
    <a href="{% url 'messager:conversation_detail' user  %}" class="card p-4 mb-3 d-flex flex-row ">
      {% thumbnail user.picture "40x40" crop="center" upscale="true"  as im %}
      <img src="{{ im.url }}" class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid"
        style="height: 40px" alt="{% trans 'Picture Profile' %}">

      {% empty %}
      <img src="{% static 'img/user.png' %}" height="40px" alt="{% trans 'No Profile Picture' %}" />
      {% endthumbnail %}
      <strong> {{ user.get_profile_name|title }} </strong>
      <span id="last-msg"> {{ msg.message|truncatechars:50 }} </span>
      <span id="msg-timestamp"> {{ msg.timestamp|date:'N d G:i' }} </span>

      {%  if msg.unread and request.user == msg.recipient %}
      <span class="pull-right ml-2" id="new-msgs"> <i class="fa fa-circle" aria-hidden="true"></i> </span>
      {% endif %}
    </a>

    {% empty %}
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <h4> {% trans "You don't have any contacts in your account." %} </h4>
        </li>
      </ol>
    </nav>

    <p>{% trans "Start a chat from the classifieds details or invite new friends! " %}</p>
    <p>{% trans "If you have questions, then you can chat with the Obrisk team member below... " %}</p>
    <p>{% trans "We will reply you within the shortest time possible." %}</p>

    <a href="{% url 'messager:conversation_detail' super_users.first.username  %}"
      class="list-group-item list-group-item-action ">
      {% thumbnail super_users.first.picture "40x40" crop="center" upscale="true"  as im %}
      <img src="{{ im.url }}" class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid"
        alt="{% trans 'Picture Profile' %}">
      {% empty %}
      <img src="{% static 'img/user.png' %}" height="40px" alt="{% trans 'No Profile Picture' %}" />
      {% endthumbnail %}
      <strong> {{ super_users.first.get_profile_name|title }} </strong> </a>
  </div>
  {% endfor %}
</div>
  
{% endblock content %}

{% get_by_name friendship_context_object_name as var %}
{% friends var %}
{% block extra_js %}
<script src="{% static 'js/messager.js' %}" type="text/javascript"></script>
{% endblock extra_js %}