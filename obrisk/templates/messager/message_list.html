{% load static i18n %}
{% load thumbnail %}

{% block head %}
<script src="{% static 'js/popper.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/bootstrap.min.js' %}" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">   
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/font-awesome-4.7.0/css/font-awesome.min.css' %}">
  <link href="{% static 'css/messager.css' %}" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
{% endblock head %}

{% block content %}
  <div class="chat">
    <div class="chat-title">
        <span > <a class="back-btn" href="{% url 'messager:contacts_list' %}" > <i class="fa fa-chevron-left" aria-hidden="true"></i> </a>
      
          <figure class="title-avatar">
            {# thumbnail user.picture "x30" as im or get username from {% request.path %} #} 
            <img src="{% static 'img/user.png' %}"  height="30px" alt="{% trans 'No Profile Picture' %}" />
          {# endthumbnail #}</figure>

           <span class="name"> {{ active}} </span>
          <span class="status"> online </span>
        </span>
       
    </div>


    <div class="messages">
        <div class="messages-content">
          {% if message_list %}
          {% for message in message_list %}
              {% include 'messager/single_message.html' with message=message %}
          {% endfor %}
        {% else %}
          <h4>{% trans 'Hello '  %} {{ request.user.username }}{% trans ' nice to meet you' %}</h4>
          <p>{% trans "I am " %} {{ active }} {% trans ", Let's talk!" %}</p>
        {% endif %}
        <div class="send-message"> </div>
      </div>
    </div>
   

  <div class="message-box">
      <form role="form" method="post" action="#" id="send">
        <div class="form-group">
          {% csrf_token %}
          <div class="input-group">
            <input type="hidden" name="to" value="{{ active }}">
            <textarea class="form-control" name="message" placeholder="{% trans 'Write a message...' %}" maxlength="1000" autofocus autocomplete="off"></textarea>
            <div class="input-group-append">
              <button class="msg_send_btn" type="submit"> <i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
            </div> 
            </div>
        </div>
      </form>
    </div>
    <!-- card end-->
  </div>

{% endblock content %}

{% block extra_js %}

  <script type="text/javascript">
 !function () {
  var container = document.querySelector('.chat');
  var contacts = document.querySelector('.contacts');
  var messages = document.querySelector('.messages');
  var small, limiter;

  function relayout () {
    var width = window.innerWidth;
    console.log(width, small);
    if (!small && width < 600) {
      small = true;
      container.classList.add('small-screen');
    } else if (small && width >= 600) {
      small = false;
      container.classList.remove('small-screen');
    }
  }

  window.addEventListener('resize', function () {
    clearTimeout(limiter);
    limiter = setTimeout(relayout, 100);
  });

  relayout();
}();


 var currentUser = "{{ request.user.username }}";

      var activeUser = "{{ active }}";
      //This scrolls the div #messages only to the bottom
      var d = $('.messages');
      d.scrollTop(d.prop("scrollHeight"));

  </script>
  <script src="{% static 'js/messager.js' %}" type="text/javascript"></script>
 {% endblock extra_js %}
