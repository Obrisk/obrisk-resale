{% extends 'base.html' %}
{% load static i18n humanize %}


{% block head %}
<link href="{% static 'css/stories.css' %}?v=1" rel="stylesheet">
<link rel="stylesheet" href="/static/css/uploader.css" />
<link rel="stylesheet" href="/static/css/video.min.css" />

<title>Obrisk Stories</title>
{% endblock head %}


{% block content %}
<div class="app-overlay"></div>

<!-- Container -->
{% comment %}
<div>
  <ul class="nav navbar-nav navbar-right">
    {% if not hide_search %}
    <form class="form-inline navbar-left" role="search" action="{% url 'stories:results' %}">
      <div class="input-group">
        <input name="query" type="search" id="searchInput" class="form-control" placeholder="{% trans 'Search' %}"
          aria-label="Search">
        <div class="input-group-append">
          <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
        </div>
      </div>
    </form>
    {% endif %}
  </ul>
</div>

{% endcomment %}
{% csrf_token %}
<div class="container mt-5">
  <div class="row mt-4">

    <div class="col-md-6 m-auto mt-0 p-sm-0">
      <div id="compose-card" class="card is-new-content">
        <!-- Top tabs -->
        <div class="tabs-wrapper">
          <div class="tabs is-boxed is-fullwidth">
            <ul>
              <li class="is-active">
                <a>
                  <i data-feather="edit-3"></i>
                  <span>Publish</span>
                </a>
              </li>
              <!-- Close X button -->
              <li class="close-wrap d-none">
                <span class="close-publish">
                  <i data-feather="x"></i>
                </span>
              </li>
            </ul>
          </div>

          <!-- Tab content -->
          <form role="form" method="post" action="#" onsubmit="return false" id="postStoriesForm">
            {% csrf_token %}
            <div class="tab-content">
              <!-- Compose form -->
              <div class="compose">

                <div class="compose-form">
                  <p class="image is-48x48">
                    {% if request.user.picture %}
                    <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{request.user.picture}}"
                      alt="Picture Profile" style="width:35px;height:35px;border-radius: 50%;"
                      class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" id="pic">
                    {% else %}
                    <img class="pull-left mr-2" src="{% static 'img/user.png' %}" height="35px"
                      alt="No Profile Picture" />
                    {% endif %}
                  </p>
                  <div class="control textarea-parent">
                    <p class="counter" style="font-size: .8rem;color: #999;float: right;"> <span class="count">400
                      </span> Characters</p>

                    <textarea id="publish" name="post" class="textarea publish-textarea" rows="3"
                      placeholder="Share something..." maxlength="400">
                  </textarea>
                    <input type="text" id="id_images" name="images" class="d-none">
                    <input type="text" id="id_video" name="story_video" class="d-none">
                    <input type="text" id="id_img_error" name="img_error" class="d-none">
                  </div>

                </div>

              </div>
              <!-- /Compose form -->
              <!-- Media and Visibility -->
              <div class="hidden-options">
                <div class="target-channels">
                  <!-- Publication Channel -->
                  <div class="channel">
                    <div id="basic-options" class="compose-options flex-column flex-lg-row" style="background:none;">
                      <!-- Upload action -->
                      <div id="addBtn" class="compose-option mb-2" style="background:#fff;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          class="feather feather-camera">
                          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                          </path>
                          <circle cx="12" cy="13" r="4"></circle>
                        </svg>
                        <span>Image</span>
                      </div>
                      <div id="addVideo" class="compose-option mb-2" style="background:#fff;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          class="feather feather-video">
                          <polygon points="23 7 16 12 23 17 23 7" />
                          <rect x="1" y="5" width="15" height="14" rx="2" ry="2" /></svg>
                        <span>Video</span>
                      </div>
                    </div>
                    <!-- Dropdown menu -->
                    <div
                      class="dropdown is-spaced is-modern is-right is-neutral dropdown-trigger is-active select-viewers">
                      <div>
                        <button id="selected-status" class="button" aria-haspopup="true">
                          <svg id="viewer-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="2" y1="12" x2="22" y2="12"></line>
                            <path
                              d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                            </path>
                          </svg>
                          <span>Public</span>
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-chevron-down caret">
                            <polyline points="6 9 12 15 18 9"></polyline>
                          </svg>
                        </button>
                      </div>
                      <div class="dropdown-menu select-status" role="menu">
                        <div class="dropdown-content">
                          <button class="dropdown-item" data-status="P">
                            <div class="media">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-globe">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="2" y1="12" x2="22" y2="12"></line>
                                <path
                                  d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                </path>
                              </svg>
                              <div class="media-content">
                                <h3>Public</h3>
                                <small>Anyone can see this post.</small>
                              </div>
                            </div>
                          </button>
                          <button class="dropdown-item" data-status="C">
                            <div class="media">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-users">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                              </svg>
                              <div class="media-content">
                                <h3>Connects</h3>
                                <small>Only connects can see this post</small>
                              </div>
                            </div>
                          </button>
                          <button class="dropdown-item" data-status="A">
                            <div class="media">
                              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-map-pin">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                                <circle cx="12" cy="10" r="3" /></svg>
                              <div class="media-content">
                                <h3>Around</h3>
                                <small>Only people in your city can see this post.</small>
                              </div>
                            </div>
                          </button>

                        </div>
                      </div>
                      <input type="hidden" name="viewers" value="P" id="viewers">
                    </div>
                  </div>
                  <div class="channel">
                    <div id="wrapper" class="mb-4 w-100">
                      <div class="container" style="display: none; padding: 0;">
                        <div id="uploader">
                          <div class="queueList">

                          </div>
                        </div>
                        <div id="statusBar" class="statusBar  flex-column align-items-center" style="display: flex;">
                          <div class="total-progress">
                            <div id="totalProgressBar" class="total-progress-bar" role="progressbar" aria-valuenow="0"
                              aria-valuemin="0" aria-valuemax="100">
                            </div>
                          </div>

                          <a id="startUpload" href="javascript:void(0);" class="is-hidden">Upload images</a>

                        </div>

                        <div class="" style="clear: both;">
                          <p class="text-center">
                            Notes:
                            Not more than 8 images &amp; Max size per image is 13MB
                          </p>
                          <button id="retry-button" type="button"
                            class="button is-solid accent-button is-fullwidth is-hidden">
                            Retry
                          </button>
                        </div>
                      </div>
                    </div>

                    <div class="container bs-docs-container">
                      <form id="form">
                        <input id="image-file" type="file" style="display:none;" multiple="multiple" accept="image/*" />
                      </form>
                      <form id="video-form">
                        <input id="video-file" type="file" style="display:none;" multiple="multiple" accept="video/*" />
                      </form>
                    </div>
                  </div>
                </div>


              </div>

              <!-- Footer buttons -->
              <div class="more-wrap">
                <!-- Publish button -->
                {% if request.user.is_authenticated %}

                <button id="publish-button" type="button"
                  class="submit-button button is-solid accent-button is-fullwidth is-disabled">
                  Publish
                </button>
                {% else %}

                <button id="publish-button" type="button"
                  class="button is-solid accent-button is-fullwidth is-disabled">
                  <a href="{% url 'account_login' %}"> Login & Post </a>
                </button>
                {% endif %}
              </div>
            </div>
          </form>
        </div>
      </div>
      <!-- Modals -->
      {% include 'stories/stories_form_modal.html' %}
      {% include 'stories/stories_thread_modal.html' %}
      <!-- End Modals -->

      <!-- Stories List -->
      <div class="stream-update">
        <a href="{% url 'stories:list' %}"><span class="new-posts"></span> {% trans 'There are new stories' %}</a>
      </div>
      <div class="infinite-container">
        <ul class="stream">
          {% for stories in stories_list %}
          {% include 'stories/stories_single.html' with stories=stories %}
          {% endfor %}
        </ul>
      </div>
      <div class="load">
        {% if page_obj.has_next %}
        <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}"><img
            src="{% static 'img/loading.gif' %}"></a>
        {% endif %}
      </div>
      <!-- End Stories List -->
    </div>
  </div>
</div>
<!-- End container -->

{% endblock content %}

{% block extra_js %}
<script src="{% static 'js/jquery.waypoints.min.js' %}" type="text/javascript"></script>
<script src="{% static 'js/infinite.min.js' %}" type="text/javascript"></script>
<script src="{% static 'js/aliyun-oss.min.js' %}" type="text/javascript"></script>
<link rel="stylesheet" href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/static/css/fancybox.min.css">
<script src="{% static 'js/multipleUploader.js' %}" type="text/javascript"></script>
<script src="{% static 'js/stories.js' %}" type="text/javascript"></script>
<script src="{% static 'js/video.min.js' %}" type="text/javascript"></script>
<script>


  var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
  const oss_url = "{% url 'get_oss_auth' %}"; //classifieds/get_oss_auth/
  const app = "stories";
  const user = "{{ request.user.username }}";
  var infinite = new Waypoint.Infinite({
    element: $('.infinite-container')[0],
    onBeforePageLoad: function () {
      $('.load').show();
    },
    onAfterPageLoad: function ($items) {
      $('.load').hide();
    }
  });
</script>
{% endblock extra_js %}