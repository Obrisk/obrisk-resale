{% load i18n %}
{% load humanize static %}
<div class="card is-post is-simple" data-id="{{ stories.uuid_id }}" stories-id="{{ stories.uuid_id }}">
  <!-- Main wrap -->
  <div class="content-wrap">
    <!-- Header -->
    <div class="card-heading">
      <!-- User image -->
      <div class="user-block">
        <div class="image">
          <a href="/users/{{stories.user}}">
            {% if stories.user.thumbnail %}
            <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.user.thumbnail}}" alt="Picture Profile"
              style="width:35px;height:35px;border-radius: 50%;"
              class="rounded-circle  mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid" id="pic">
            {% else %}
            <img class="pull-left mr-2" src="{% static 'img/user.png' %}" height="35px" alt="No Profile Picture" />
            {% endif %}
          </a>

        </div>
        <div class="user-info">
          <a href="/users/{{ stories.user.get_profile_name}}">{{ stories.user.get_profile_name|title }}</a>
          <span class="time">{{ stories.timestamp|naturaltime }}</span>
        </div>
      </div>
      <!-- /includes/pages/feed/dropdowns/feed-post-dropdown.html -->
      {% if stories.user == request.user %}
      <div class="dropdown is-spaced is-right is-neutral dropdown-trigger">
        <div>
          <div class="button">
            <i data-feather="more-vertical"></i>
          </div>
        </div>
        <div class="dropdown-menu" role="menu">
          <div class="dropdown-content border-0">
            <a href="{% url 'stories:delete_stories' stories.uuid_id %}" class="dropdown-item delete-story">
              <div class="media">
                <i data-feather="trash-2"></i>
                <div class="media-content">
                  <h3>Delete</h3>
                  <small>Delete this story</small>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    <!-- /Header -->


    <!-- Post body -->
    <div class="card-body">
      <!-- Post body text -->
      <div class="post-text">
        <p>{{ stories }}</p>
      </div>

      <!-- Post Video -->
      {% if stories.video %}
      <div class="post-media grid-1">

        <video id="vid-{{ stories.uuid_id }}" class="js-player" width="640px" height="267px"
        poster="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.video}}?x-oss-process=video/snapshot,t_5000,f_jpg,w_800,h_600,m_fast" 
          controls preload="meta"
          crossorigin playsinline data-plyr-config="{ 'title': 'Obrisk stories videos' }"">
          <source src=" https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.video}}" type="video/mp4">
          Your browser doesn' t support HTML5 video tag. </video>

      </div>
      {% else %}

      <!-- Post image  -->

      <div
        class="post-media {% if stories.img4 %}grid-4{% elif stories.img3 %} grid-3 {% elif  stories.img2 %} grid-2{% else  %} grid-1{%endif%}">
        <!-- CSS masonry wrap -->




        {% if stories.img1 %}
        <figure class="img1 image is-square">



          <img class="lazyload" data-src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.img1}}" alt="">

        </figure>
        {%endif%}
        {% if stories.img2%}
        <figure class=" img2 image is-square">


          <img class="lazyload" data-src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.img2}}" alt="">

        </figure>
        {%endif%}
        {% if stories.img3 %}
        <figure class="img3 image is-square">


          <img class="lazyload" data-src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.img3}}" alt="">

        </figure>
        {%endif%}
        {% if stories.img4 %}
        <figure class="img4 image is-square">


          <img class="lazyload" data-src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{stories.img4}}" alt="">

        </figure>
        {% endif %}



      </div>
      {%endif%}

      <!-- /Post image  -->

      <!-- Post actions -->
      <div class="d-flex justify-content-between post-actions">

        <div class="left align-items-center d-flex">
          <div class="fab-wrapper is-share">
            <a href="javascript:void(0);" class="small-fab share-fab share-stories"
              onclick='shareMe("{{stories.user}}","{{stories|truncatewords:30 }}","i/{{ stories.slug }}/")''>
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="feather feather-link-2">
                <path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path>
                <line x1="8" y1="12" x2="16" y2="12"></line>
              </svg>
            </a>
          </div>

          <div class="align-items-center d-flex like-wrapper">

            {% if request.user in stories.get_all_likers %}
            <a href="javascript:void(0);" class="like-button is-active">
              <i class="mdi mdi-heart not-liked bouncy"></i>
              <i class="mdi mdi-heart is-liked bouncy"></i>
              <span class="like-overlay"></span>
            </a>
            {% else %}
            <a href="javascript:void(0);" class="like-button">
              <i class="mdi mdi-heart not-liked bouncy"></i>
              <i class="mdi mdi-heart is-liked bouncy"></i>
              <span class="like-overlay"></span>
            </a>
            {% endif %}


            <small class="likes-count ml-2">
              <span class="count">{{ stories.likes_count }}</span> <span class="m-0">Liked</span>
            </small>
          </div>
        </div>

        <div class="align-items-center d-flex fab-wrapper is-comment">
          <a href="javascript:void(0);" class="small-fab comment-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="feather feather-message-circle">
              <path
                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
              </path>
            </svg>
          </a>
          <small class="comments-count">
            <span class="count ml-2">{{ stories.thread_count }}</span>
            <span class="m-0">Comments</span>
          </small></div>
      </div>

      <!-- /Post actions  -->
    </div>
    <!-- /Post body -->
    <!-- Post footer -->
    <div class="card-footer justify-content-end">
      <!-- Followers -->
      {% if stories.get_likers %}
      <div class="likers-group">
        {% for liker in stories.get_likers %}
        <a href="/users/{{liker}}">
          <img
            src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{liker.thumbnail|default_if_none:'/static/img/user.png' }}"
            alt="User profile picture">
        </a>
        {% endfor %}
      </div>
      <div class="likers-text">
        {% if stories.likes_count > 3%}
        <p><a href="javascript:void(0);" class="view-all-likers" data-toggle="modal"
            data-target=".{{ stories.uuid_id }}"> {{ stories.likes_count|add:"-3" }} More </a></p>
        <!-- popup box modal starts here -->
        <div class="modal fade demo-popup {{ stories.uuid_id }}" tabindex="-1" role="dialog"
          aria-labelledby="myLargeModalLabel-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="ml-2 modal-title"> ALL LIKES </h3>
              </div>
              <div class="modal-body likers-group">
                <P> {% for liker in stories.get_all_likers %}
                  <a href="/users/{{liker}}">
                    <img
                      src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{liker.thumbnail|default_if_none:'/static/img/user.png' }}"
                      alt="User profile picture">
                  </a>
                  {% endfor %} </P>
              </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal-->
        <!-- popup box modal ends -->
        {% endif%}
      </div>
      {% else %}
      <div class="likers-text">
        <p>Be the first to like</p>
      </div>
      {% endif %}
    </div>
    <!-- /Post footer -->
  </div>

  <!-- /Main wrap -->

  <!-- Post #6 comments -->
  <div class="comments-wrap is-hidden">
    <!-- Header -->
    <div class="comments-heading pb-0 pt-0">
      <h4>
        Comments
        (<small>{{ stories.thread_count }}</small>)
      </h4>
      <div class="close-comments">
        <i data-feather="x"></i>
      </div>
    </div>
    <!-- /Header -->
    <!-- Comments footer -->
    <div class="card-footer pb-0 pt-0">
      <div class="media post-comment">
        <!-- Textarea -->
        <div class="media-content">
          <div class="field textarea-parent">
            <p class="counter" style="font-size: .8rem;color: #999;float: right;">Remaining: <span class="count">400
              </span>Character
            </p>
            <p class="control">
              <form role="form" method="post" action="#" onsubmit="return false" class="replyStoriesForm">
                {% csrf_token %}
                <input type="hidden" name="parent" value="">
                <textarea class="textarea" name="reply" rows="1" class="textarea comment-textarea"
                  placeholder="Write a comment...">
                      </textarea>

              </form>
            </p>
          </div>
          <!-- Additional actions -->
          <div class="actions">
            <a id="post-comment-button" class="button primary-button is-solid raised">Post Comment</a>
          </div>
        </div>
      </div>
    </div>
    <!-- /Comments footer -->
    <!-- Comments body -->
    <div class="comments-body has-slimscroll">
      <div class="comments-placeholder">
        <img src="{% static 'frontend/assets/images/icons/feed/bubble.svg' %}" alt="">
        <h3>Nothing in here yet</h3>
        <p>Be the first to post a comment.</p>
      </div>
    </div>
    <!-- /Comments body -->


  </div>
  <!-- /Post #6 comments -->
</div>

<!-- Todo: Create json ld for stories -->
<script>
  $(document).ready(function () {
    $(' .post-text').linkify({ target: "_blank" });
  }); </script>
