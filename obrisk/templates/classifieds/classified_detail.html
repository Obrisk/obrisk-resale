{% extends 'base.html' %}
{% load static i18n %}
{% load crispy_forms_tags thumbnail humanize %}

{% block head %}
<link href="{% static 'css/classifieds.css' %}" rel="stylesheet">
<link href="{% static 'css/classified-details.css' %} " rel="stylesheet">
<link href="{% static 'css/colors.css' %}" rel="stylesheet">
<script src="{% static 'js/fancybox.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/slider-pro.min.css' %}">
<link rel="stylesheet" href="{% static 'css/fancybox.min.css' %}">
<script src="{% static 'js/jquery.sliderPro.min.js' %}"></script>


<title>{{ classified.title|title }}</title>

{% endblock head %}


{% block icon %}
<link rel="icon" type="image/png" href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}">
<link rel="shortcut icon" href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}">
<link rel="apple-touch-icon" sizes="180x180"
  href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}">
<link rel="icon" type="image/png" sizes="32x32"
  href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}">
<link rel="icon" type="image/png" sizes="16x16"
  href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}">
<link rel="mask-icon" href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}" color="#5bbad5">
{% endblock %}


{% block meta %}
<meta name="author" content="{{ classified.user.get_profile_name }}">
<meta name="keywords" content="{{ classified.title }} ,{{ classified.address }}, {{ classified.city }}">
<meta name="description" content="{{ classified.details }}">
{% endblock %}


{% block content %}
<!-- Page Content -->
<div class="container mt-5 mb-md-5">

  <div class="row">
    <!-- Post Content Column -->

    <div class="classified-wrapper col-lg-8 col-md-10 m-auto">

      <section class="col">
        <div class="classified-meta mb-4">
          <!-- Title -->
          <h3 class="mt-4 text-left">{{ classified.title|title }}</h3>

          <div class="meta-details mt-4 d-flex justify-content-between flex-column flex-md-row">

            <div class="meta-right d-flex">
              <a href="{% url 'users:detail' classified.user.username %}" class="mr-2">
                {% if classified.user.thumbnail %}
                <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{classified.user.thumbnail}}"
                  alt="Picture Profile" style="height:35px; max-width:35px; border-radius: 50%;" id="pic">
                {% else %}
                <img src="{% static 'img/user.png' %}" height="35px" width="35px" alt="No Profile Picture" />
                {% endif %}
              </a>
              <!-- Location -->
              <div class="meta-left d-flex flex-column">
                <a itemprop="author" itemscope="" itemtype="http://schema.org/Person"
                  href="{% url 'users:detail' classified.user.username %}">
                  <strong itemprop="name" id="classified-user">
                    {{ classified.user.get_profile_name|title }} </strong>
                </a>
                <div class="location">
                  <small class="card-subtitle mb-2">üìç</small>
                  <span class="card-subtitle mb-2">
                    {% if classified.address  %}
                    {{ classified.address }}, {{ classified.city }}
                    {% else %}
                    {{ classified.user.city }}
                    {% endif %} </span>
                </div>
                <!-- Date/Time -->
                <div class="time mt-2"><small>‚è≤Ô∏è</small><span>{{ classified.timestamp|naturaltime }} </span></div>

              </div>
            </div>

            <div
              class="align-items-baseline align-items-md-end d-flex flex-column meta-right ml-xl-0 mr-xl-0 mt-4 mt-md-0 ml-0 mr-0">
              <!-- Price -->
              <h3 class="O-cl-red price">
                <strong>{% trans 'CNY' %} {{ classified.price }}</strong>
              </h3>
              {% if classified.user != request.user %}
              <a href="{% url 'messager:classified_chat' classified.user classified.id %}" class="btn btn-action">
                üó™ <strong> {% trans ' Chat with the seller' %} </strong></a> <br>
              <br>
              {% endif %}
            </div>

          </div>

        </div>
        <div class="col-lg-9 m-auto h-50">

          <div class="slider-pro mt-4 mb-4" id="image-slider">
            <div class="sp-slides">
              {% for image in images %}
              <div class="sp-slide">
                <a href="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{ image }} " data-fancybox="classified-gallery">
                  <img class="sp-image" src="{% static 'img/blank.gif' %}"
                    data-src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{ image }}" />
                </a>
              </div>
              {% endfor %}
            </div>
          </div>

        </div>

        <div class="card-text text-justify">{{ classified.details }}</div>

        
        {% if user.is_authenticated %}
          {% if classified.phone_number %}
            <br />
            <small class="seller-contacts"><strong> üì±Seller's contacts :</strong>
              {{ classified.phone_number }}</small>
          {% endif %}
        
          {% if classified.wechat_id %}
              <small class="seller-contacts"><strong> Seller's WechatID :</strong>
              {{ classified.wechat_id }}</small>
          
          {% endif %}
        
        {% else %}
        <h6> Please login to view seller's contacts: </h6>
        <a class="btn btn-dark btn-xl js-scroll-trigger text-dark"
          href="{% url 'account_login' %}">{% trans 'Login' %}</a>

        {% endif %}
      </section>


      <!-- Cloud Tag Widget -->
      {% if classified.tags.all %}
      <div class="card my-4">
        <h5 class="card-header O-bg-blue-ns">{% trans 'Tags' %}</h5>
        <div class="card-body">
          {% for tag in classified.tags.all %}
          <a href="{% url 'classifieds:list_by_tag' tag.slug %}"><span class="badge badge-info">{{ tag }}</span></a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Navigation buttons -->
      {% if request.user == classified.user%}
      <div class="m-3">
        <a class="btn btn-dark" href="{% url 'classifieds:edit_classified' classified.id %}"
          title="{% trans 'Edit this classified' %}">
          <i class="fa fa-pencil-square-o" aria-hidden="true"></i> {% trans 'Edit' %}</a>
      </div>
      {% else %}
      <!-- <a href="{% url 'classifieds:report_classified' classified.id %}" class="btn btn-danger" title="{% trans 'Report this classified' %}">{% trans 'Report' %} </a> -->
      {% endif %}
      <div class="m-3 d-flex justify-content-between">
        <a href="{% url 'classifieds:list' %}" class="btn btn-dark"> &larr;{% trans 'Home' %} </a>
        {% comment  %}
        <a href="#" class="share btn btn-dark"
          onclick="share('{{ classified.title|title }}','{{ classified.price|title }} ')">
          üîó{% trans 'share' %} </a>

        {% endcomment %}
      </div>
    </div>


    <!-- Similar lassified -->
    {% if similar_classifieds %}
    <div class="col-lg-8 col-md-10 mr-auto ml-auto related-card mt-4 pt-4 mb-4">
      <h5 class="card-header O-bg-blue-ns">Related Classifieds</h5>
      <div class=" related mt-4 mb-4">
        <!-- Classified Entries Column -->
        <!-- <div class="col-md-8"> -->
        {% for classified in similar_classifieds %}
        <!-- Classified ad. -->
        <div class="card classified-card mr-2 mb-3">
          <!--Display image-->
          <div class="card-img-top img-responsive">
            <a href="{% url 'classifieds:classified' classified.slug %}"
              style="color:black; text-decoration:none; background-color:none">
              {% if classified.image_thumb %}
              <img class="card-img" src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{ classified.image_thumb }}">
              {% else %}
              <img class="card-img" src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/classifieds/default.jpg">
              {% endif %}
          </div>

          <div class="card-body">
            <h6 class="card-title"> {{ classified.title|truncatechars:20}} </h6>
            <p class="card-subtitle O-cl-red"> CNY {{ classified.price|title }} </p>
            <div class="card-meta d-flex justify-content-between">
              <div class="location">
                <small>üìç</small>
                <span class="card-text small "> {{ classified.city|safe }}</span>
              </div>
              <div class="share-card">
                <small>üîó</small>
              </div>
            </div>

          </div>
          </a>
        </div>
        {% endfor %}
      </div>

    </div>

  </div>
  {% endif %}


</div>
<script type="application/ld+json">
{
   "@context":"http://schema.org/",
   "@type":"Product",
   "name":"{{ classified.title|title }}",
   "description":"{{ classified.details }}",
   "image":[
      "https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{images.0.image_thumb }}"
   ],
   "brand":"",
   "offers":{
      "@type":"Offer",
      "priceCurrency":"CNY",
      "price":{{ classified.price }},
      "availability":"http://schema.org/InStock",
      "itemCondition":"http://schema.org/UsedCondition",
      "url":"https://obrisk.com{% url 'classifieds:classified' classified.slug %}",
      "seller":{
         "@type":"Person",
         "name":"{{ classified.user.get_profile_name }}",
         {% if classified.user.thumbnail %}
         "image":"https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{classified.user.thumbnail}}"
         {% else %}
        "image":"https://obrisk.oss-cn-hangzhou.aliyuncs.com/classifieds/default.jpg"
         {% endif %}
         
      }
   }
}
</script>
<script type="text/javascript">
  function share(title, text) {
    url = location.href
    if (window.navigator.share) {
      window.navigator.share({
        title: title,
        text: text,
        url: url
      }).

        then(function () {
          return console.log('Successful share');
        })["catch"](function (error) {
          return console.log('Error sharing', error);
        });
    } else {
      window.navigator.clipboard.writeText(url);
      bootbox.alert("copied to clipboard");

    }
  }
  jQuery('.share').click(function (e) {
    e.preventDefault();
  })
  $(".slider-pro").sliderPro({
    width: 960,
    height: 500,
    arrows: true,
    keyboard: false,
    fade: true,
    autoplay: false,
    autoScaleLayers: false,
    fadeArrows: false,
    touchSwipe: false
  });
</script>
{% endblock content %}