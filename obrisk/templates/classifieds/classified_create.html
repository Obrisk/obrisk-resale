{% extends 'base.html' %}
{% load static i18n %}
{% load crispy_forms_tags %}

{% block head %}
<link href="{% static 'css/classified-create.css' %}" rel="stylesheet"/>
{% endblock head %}

{% block content %}
    <form action="{% url 'classifieds:write_new' %}" name="classifiedForm" enctype="multipart/form-data"
          id="classified-form" method="post" role="form">
          {% csrf_token %}

          <div class="notification is-danger is-hidden" role="alert">
            <button type="button" class="delete close-dj-messages"></button>
            <p id="notf-msg"></p>
          </div>

          <div class="column">
                  <div class="field">
                        <label>
                            {% trans 'Title*' %}
                        </label>
                        <div class="control">
                          <input type="text" id="id_title" name="title" maxlength="80" class="input" required
                            placeholder="Enter your item title">
                        </div>
                  </div>
                  <div class="field">
                        <label>
                            {% trans 'Details*' %}
                        </label>
                        <div class="control">
                          <textarea name="details" id="id_details" cols="40" rows="3" maxlength="2000" required
                            class="textarea" placeholder="Provide enough details"></textarea>
                        </div>
                  </div>

                  <div class="price">
                      <label>
                          {% trans 'Price*' %}
                      </label>
                      <span> Â¥
                          <input type="number" id="id_price" name="price" class="numberinput input" id="id_price"
                            required step=".01" value="0" placeholder="Item price">
                      <span>
                  </div>
                  <small> {% trans '0 for GIVEAWAY' %}
                  </small>

                  <div class="hidden-fields">
                    <input type="hidden" id="id_images" name="images" maxlength="3000" class="input" required>
                    <input type="hidden" id="id_img_errors" name="img_errors" maxlength="2000" class="input">
                    <input type="hidden" id="id_edited" name="edited" class="input">
                    <input type="hidden" id="id_status" name="status" maxlength="20" class="input">
                  </div>

                  {% if request.user.phone_number.national_number != 13300000000 and request.user.phone_number.national_number >= 1 %}
                      <div class="field include-phone">
                        <label> 
                            {% trans 'Include your phone no? ' %}
                        </label>
                        <label class="f-switch is-accent">
                          <input type="checkbox" checked class="is-switch" name="show_phone" id="id_show_phone">
                          <i></i>
                        </label>
                      </div>
                  {% else %}
                      <div class="field">
                        <label for="id_phone_number" class="">
                            {% trans 'Phone number(optional)' %}
                        </label>
                        <input type="tel" name="phone_number" placeholder="Don't enter country code" class="input"
                          id="id_phone_number">
                      </div>
                  {% endif %}

                <div class="field">
                  <label>
                      {% trans 'Images*' %}
                  </label>

                  <div class="control" id="wrapper">
                        <div id="container">
                                <div id="uploader">
                                  <div class="queueList">
                                    <ul class="filelist"></ul>
                                  </div>
                                </div>

                                <div id="statusBar" class="statusBar flex-column align-items-center" style="display:none">
                                      <div class="total-progress">
                                        <div id="totalProgressBar" class="total-progress-bar" role="progressbar"
                                          aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                      </div>

                                      <div class="upload-btn is-flex flex-column">
                                        <div class="start-uploader startUploadBtn">
                                          <a id="startUpload" href="javascript:void(0);" class="button is-solid accent-button">
                                              {% trans 'Upload images' %}
                                          </a>
                                        </div>

                                        <div class="start-uploader addBtn">
                                          <a id="addBtn" href="javascript:void(0);" class="button is-solid accent-button">
                                              {% trans 'Add images' %}
                                          </a>
                                        </div>
                                </div>
                        </div>

                        <div class="img-pick-wrapper">
                          <div id="uploaderPick">
                            <a id="chooseFile" href="javascript:void(0);" class="button is-solid accent-button">
                                {% trans 'Add images' %}
                            </a>
                          </div>
                        </div>

                        <div class="" style="clear: both;">
                          <small>
                              {% trans 'Notes:' %}
                              {% trans 'Can select up to 8 multiple images & Max size per image is 13MB' %}
                          </small>
                        </div>
                <!--close wrapper id -->
                </div>

                <div class="bs-docs-container">
                  <form id="form">
                    <input id="image-file" type="file" style="display:none;" multiple="multiple"
                      accept="image/*" />
                  </form>
                </div>

                <div class="buttons img-pick-wrapper">
                  <button id="cancel-classified" type="button" class="button is-solid opt-accent-button raised"
                    onclick="javascript:history.back()"> 
                    {% trans 'Cancel' %}
                  </button>

                  {% if request.user.is_authenticated %}
                      <button id="create-btn" type="button"
                        class="button is-solid accent-button raised create submit-button">{% trans 'Submit' %}</button>
                  {% else %}
                      <button id="create-btn" type="button" onclick="window.location.href='/auth/login/'"
                        class="login-to-post button is-solid accent-button raised"> 
                          {% trans 'Login & Post ' %}
                     </button>
                  {% endif %}
               </div>
     <!-- close form column -->
     </div>

  </form>
  {{ form.media }}

   <div id="error-modal" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <!-- dialog body -->
          <div class="modal-body">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>

          <!-- dialog buttons -->
          <div class="modal-footer">
              <button type="button" class="btn btn-primary">OK</button>
          </div>
        </div>
      </div>
  </div>
{% endblock content %}

{% block extra_js %}

<script type="text/javascript">

  const oss_url = "{% url 'get_oss_auth' %}"; //classifieds/get_oss_auth/
  const user = "{{ request.user.username }}";
  const app = "classifieds";

  const title_id = "{{ form.title.auto_id }}";
  const details_id = "{{ form.details.auto_id }}";
  const address = "{{ form.address.auto_id }}";
</script>

<link href="{% static 'css/wnoty.css' %}" rel="stylesheet"/>
<script src="{% static 'js/vendor/jquery.min.js' %}" type="text/javascript"></script>
<script defer src="{% static 'js/vendor/aliyun-oss.min.js' %}" type="text/javascript"></script>
<script defer src="{% static 'js/wnoty.js' %}" type="text/javascript"></script>
<script defer src="{% static 'js/vendor/transliteration.min.js' %}" type="text/javascript"></script>
<script defer src="{% static 'js/multipleUploader.js' %}" type="text/javascript"></script>
<script defer src="{% static 'js/classifieds-create.js' %}" type="text/javascript"></script>
{% endblock extra_js %}
