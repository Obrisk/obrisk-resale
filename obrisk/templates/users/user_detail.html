{% extends "base.html" %}
{% load static i18n %}

{% block title %}{{ object.username }}{% endblock %}

{% block head %}
<link href="{% static 'css/user_profile.css' %}?v=200719" rel="stylesheet">

{% endblock head %}

{% block content %}
<a href="{% url 'stories:list' %}" class="d-sm-block d-md-none btn btn-dark"> <i class="fa fa-chevron-left"
    aria-hidden="true"></i></a>

<div class="col-md-8 m-auto">
  <div class="media user-profile profile-header d-flex flex-column">
    {% if object.picture %}
    <img src="https://obrisk.oss-cn-hangzhou.aliyuncs.com/{{object.picture}}" alt="Picture Profile"
      class="mb-3 mb-md-0 mr-md-3 profile-header-avatar img-fluid profile-pic" id="pic">
    {% else %}
    <img class="pull-right" src="{% static 'img/user.png' %}" height="250px" alt="No Profile Picture" />
    <small class="lazy-img"> {{ object.username }} is too lazy to upload the profile pic.</small>
    {% endif %}

    <div class="media-body">
      <h1 class="mt-0">{{ object.username|title }}</h1>

    </div>
    <div class="profile-points">
      <div class="point-label"> <i class="fa fa-gift"> </i> {% trans 'Points' %}</div>
      <div class="points"> {{ object.points }} </div>
    </div>

    <div>
      {% if request.user.username == object.username %}
      <div class="d-flex mb-2">
        <a class="btn btn-dark m-auto" href="{% url 'users:update' %}">{% trans 'Update Profile' %}</a>

      </div>

      <div class="">
        {%if object.is_official %}
        <a class="button has-min-width m-auto"
          href="{% url 'connections:friendship_followers'  %}">{% trans 'Followers🤝' %}</a>
        {% else %}
        <a class="button has-min-width m-auto"
          href="{% url 'connections:friendship_following' %}">{% trans 'Following' %}</a>
        {% endif %}

        <a class=" button has-min-width m-auto"
          href="{% url 'connections:friendship_view_friends' %}">{% trans 'Connects' %}</a>
      </div>
      {% else %}
      <div class="d-flex mb-2">


        {% if object in friends %}
        <a class="button has-min-width m-auto"
          href="{% url 'messager:conversation_detail' object.username  %}">{% trans '💬Chat' %}</a>
        {% elif object in pending %}
        <a class="connect-btn button has-min-width m-auto" href="#">{% trans 'Pending' %}</a>
        {% else %}
        <a class="connect-btn button has-min-width m-auto" href="#">{% trans '➕Connect' %}</a>
        {% endif %}
      </div>
      <div class="d-flex mb-2">
        {% if object in following %}
        <a class="btn btn-outline-danger m-auto"
          href="{% url 'connections:follower_remove'  object.username  %}">{% trans 'Unfollow' %}</a>
        {% else %}
        {% if object.is_official %}
        <a class="button has-min-width m-auto"
          href="{% url 'connections:follower_add'   object.username %}">{% trans 'Follow' %}</a>
        {% endif %}
        {% endif %}
      </div>
      {% endif %}
    </div>
    <!--This is else statement. <i class="fa fa-envelope" aria-hidden="true"></i><a class="email" href="mailto:{{ object.email }}">   {{ object.email }}</a><br /> -->
  </div>
  <div class="container profile-wrapper">

    <div id="contact-info" class="vcard">

      {% if object.is_seller %}

      {% endif %}

      <p>
        {% if object.instagram_account %}
        <a href="https://www.instagram.com/{{ object.instagram_account }}" style="font-size: 2em"
          title="{% trans 'Instagram Profile' %}"><i class="fa fa-instagram"></i> </a>
        {% endif %}

        {% if object.linkedin_account %}
        <a href="https://www.linkedin.com/in/{{ object.linkedin_account }}" style="font-size: 2em"
          title="{% trans 'LinkedIn Profile' %}"><i class="fa fa-linkedin"></i> </a>
        {% endif %}

        {% if object.snapchat_account %}
        <a href="https://www.snapchat.com/add/{{ object.snapchat_account }}" style="font-size: 2em"
          title="{% trans 'Snapchat Profile' %}"><i class="fa fa-snapchat"></i> </a>
        {% endif %}

        {% if object.facebook_account %}
        <a href="https://www.facebook.com/{{ object.facebook_account }}" style="font-size: 2em"
          title="{% trans 'Facebook Profile' %}"><i class="fa fa-facebook"></i> </a>
        {% endif %}

        <br />
        {% if object.name %}
        👤{{ object.name|title  }}
        {% endif %}

        <br />
        {% if object.city %}
        <span class="fa"> 📍{{ object.city }} </span> <br />
        {% endif %}
        <br />
        {% if object.job_title %}
        💼{{ object.job_title }} <br />
        {% else %}
        <p>🛌 {{ object.username }} is too lazy to add a job title.</p>
        {% endif %}
      </p>

      {% if object.bio %}
      <div class="panel-body" id="objective">
        <p>📇{{ object.bio }}</p>
      </div>
      {% else %}
      <p> 🛌{{ object.username}} is too lazy to write a short bio.</p>
      {% endif %}
      <div class="clear"></div>
    </div>

  </div>
</div>
<script>
  function getCookie(name) {
    // Function to get any cookie available in the session.
    var cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      var cookies = document.cookie.split(";");
      for (var i = 0; i < cookies.length; i++) {
        var cookie = jQuery.trim(cookies[i]);
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const username = "{{ object.username }}";
  var csrftoken = getCookie("csrftoken");


  $(".connect-btn").click(function (e) {
    bootbox.confirm("Send friend request ?", function (result) {
      if (result) {
        $.ajax({
          beforeSend: function (xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
          },
          type: "POST",
          url: "/connections/friend/add/" + username + "/",
          data: {
            to_username: username
          },
          dataType: "json",
          success: function (response) {
            if (response) {
              bootbox.alert({
                message: response.message,
                size: 'small'
              });
            } else {
              bootbox.alert({
                message: "Sorry something went wrong , Please try again later.",
                size: 'small'
              });
            }

          }

        });
      }
    });

  });
</script>

{% endblock content %}